{
  "updatedAt": "2025-07-01T16:48:25.188Z",
  "createdAt": "2025-07-01T16:47:38.743Z",
  "id": "4BF1Q121wJzvRKsn",
  "name": "LINEéŒ¯é¡Œåˆ†æèˆ‡çµ±è¨ˆ",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "id": "node_1",
      "name": "LINEéŒ¯é¡Œåˆ†ææ¥æ”¶",
      "type": "n8n-nodes-base.webhook",
      "parameters": {
        "httpMethod": "POST",
        "path": "line-answer-analysis",
        "responseMode": "responseNode"
      },
      "position": [
        0,
        300
      ],
      "typeVersion": 1
    },
    {
      "id": "node_2",
      "name": "è§£æç­”é¡Œçµæœ",
      "type": "n8n-nodes-base.code",
      "parameters": {
        "jsCode": "// è§£æ LINE å‚³ä¾†çš„ç­”é¡Œçµæœ\nconst webhookData = $input.first().json;\nconst messageText = webhookData.body.events[0].message.text;\nconst userId = webhookData.body.events[0].source.userId;\nconst replyToken = webhookData.body.events[0].replyToken;\n\nconsole.log('æ”¶åˆ°è¨Šæ¯:', messageText);\nconsole.log('ç”¨æˆ¶ID:', userId);\n\n// è§£æç­”é¡Œæ ¼å¼ï¼š1A2B3C4D5A... æˆ– \"ç­”æ¡ˆï¼š1A2B3C4D\"\nlet answerPattern = /(\\d+)([ABCD])/g;\nlet match;\nconst userAnswers = [];\n\n// æ¸…ç†è¨Šæ¯å…§å®¹\nlet cleanMessage = messageText.replace(/ç­”æ¡ˆ[ï¼š:]?\\s*/g, '').replace(/\\s+/g, '');\n\nwhile ((match = answerPattern.exec(cleanMessage)) !== null) {\n  userAnswers.push({\n    questionNumber: parseInt(match[1]),\n    selectedAnswer: match[2],\n    answerIndex: match[2].charCodeAt(0) - 65 // A=0, B=1, C=2, D=3\n  });\n}\n\nif (userAnswers.length === 0) {\n  // å¦‚æœæ²’æœ‰æ‰¾åˆ°æ¨™æº–æ ¼å¼ï¼Œå˜—è©¦å…¶ä»–æ ¼å¼\n  const simplePattern = /([ABCD])/g;\n  const letters = cleanMessage.match(simplePattern);\n  \n  if (letters && letters.length > 0) {\n    letters.forEach((letter, index) => {\n      userAnswers.push({\n        questionNumber: index + 1,\n        selectedAnswer: letter,\n        answerIndex: letter.charCodeAt(0) - 65\n      });\n    });\n  }\n}\n\nconsole.log('è§£æåˆ°çš„ç­”æ¡ˆ:', userAnswers);\n\nreturn [{\n  json: {\n    userId: userId,\n    replyToken: replyToken,\n    originalMessage: messageText,\n    userAnswers: userAnswers,\n    totalAnswered: userAnswers.length,\n    timestamp: new Date().toISOString(),\n    needsAnalysis: userAnswers.length > 0\n  }\n}];"
      },
      "position": [
        200,
        300
      ],
      "typeVersion": 1
    },
    {
      "id": "node_3",
      "name": "åˆ†æéŒ¯é¡Œä¸¦ç”Ÿæˆå ±å‘Š",
      "type": "n8n-nodes-base.code",
      "parameters": {
        "jsCode": "// æ¨¡æ“¬é¡Œåº«è³‡æ–™ (å¯¦éš›æ‡‰è©²å¾ Google Sheets æˆ– JSON æª”æ¡ˆè®€å–)\n// é€™è£¡ä½¿ç”¨æ‚¨æä¾›çš„é¡Œåº«æ ¼å¼\nconst questionBank = [\n  {\n    \"number\": 1,\n    \"question\": \"å¤šæ¨¡æ…‹AI (Multimodal AI) çš„å®šç¾©æ˜¯ä»€éº¼ï¼Ÿ\",\n    \"correct_answer_letter\": \"B\",\n    \"correct_answer_index\": 1,\n    \"topic\": \"5.ç¥ç¶“ç¶²è·¯æ¨¡å‹èˆ‡æŠ€è¡“\",\n    \"subtopic\": \"5.3.é‡è¦æŠ€è¡“æ¦‚å¿µ\",\n    \"concept\": \"å¤šæ¨¡æ…‹AI (Multimodal AI)\"\n  },\n  {\n    \"number\": 2,\n    \"question\": \"èªè¨€ç¿»è­¯çš„åŸºæœ¬åŸç†æ˜¯ä»€éº¼ï¼Ÿ\",\n    \"correct_answer_letter\": \"A\",\n    \"correct_answer_index\": 0,\n    \"topic\": \"3.ç”Ÿæˆå¼AIæ‡‰ç”¨æŠ€èƒ½\",\n    \"subtopic\": \"3.1.æ–‡å­—ç”Ÿæˆå·¥å…·èˆ‡æ‡‰ç”¨\",\n    \"concept\": \"èªè¨€ç¿»è­¯\"\n  }\n  // é€™è£¡å¯ä»¥æ·»åŠ æ›´å¤šé¡Œç›®...\n];\n\nconst userData = $input.first().json;\nconst userAnswers = userData.userAnswers;\n\nlet correctCount = 0;\nlet wrongAnswers = [];\nlet topicStats = {};\n\n// åˆ†ææ¯å€‹ç­”æ¡ˆ\nuserAnswers.forEach(userAnswer => {\n  const questionNum = userAnswer.questionNumber;\n  const question = questionBank.find(q => q.number === questionNum);\n  \n  if (question) {\n    const isCorrect = userAnswer.selectedAnswer === question.correct_answer_letter;\n    \n    if (isCorrect) {\n      correctCount++;\n    } else {\n      wrongAnswers.push({\n        questionNumber: questionNum,\n        question: question.question,\n        userAnswer: userAnswer.selectedAnswer,\n        correctAnswer: question.correct_answer_letter,\n        topic: question.topic,\n        subtopic: question.subtopic,\n        concept: question.concept\n      });\n    }\n    \n    // çµ±è¨ˆå„ä¸»é¡Œè¡¨ç¾\n    if (!topicStats[question.topic]) {\n      topicStats[question.topic] = { correct: 0, total: 0 };\n    }\n    topicStats[question.topic].total++;\n    if (isCorrect) {\n      topicStats[question.topic].correct++;\n    }\n  }\n});\n\n// è¨ˆç®—åˆ†æ•¸å’Œç­‰ç´š\nconst totalQuestions = userAnswers.length;\nconst score = Math.round((correctCount / totalQuestions) * 100);\nlet grade = 'D';\nif (score >= 90) grade = 'A+';\nelse if (score >= 80) grade = 'A';\nelse if (score >= 70) grade = 'B';\nelse if (score >= 60) grade = 'C';\n\n// ç”Ÿæˆå»ºè­°\nlet suggestions = [];\nif (wrongAnswers.length > 0) {\n  const weakTopics = Object.entries(topicStats)\n    .filter(([topic, stats]) => stats.correct / stats.total < 0.7)\n    .map(([topic]) => topic);\n  \n  if (weakTopics.length > 0) {\n    suggestions.push(`éœ€è¦åŠ å¼·ï¼š${weakTopics.join('ã€')}`);\n  }\n}\n\n// ç”Ÿæˆåˆ†æå ±å‘Šæ–‡å­—\nlet reportText = `ğŸ“Š ç­”é¡Œåˆ†æå ±å‘Š\\n\\n`;\nreportText += `ğŸ¯ ç¸½é«”è¡¨ç¾ï¼š\\n`;\nreportText += `â€¢ ç­”é¡Œæ•¸é‡ï¼š${totalQuestions} é¡Œ\\n`;\nreportText += `â€¢ æ­£ç¢ºé¡Œæ•¸ï¼š${correctCount} é¡Œ\\n`;\nreportText += `â€¢ ç­”å°ç‡ï¼š${score}% (${grade})\\n\\n`;\n\nif (wrongAnswers.length > 0) {\n  reportText += `âŒ éŒ¯é¡Œåˆ†æï¼š\\n`;\n  wrongAnswers.forEach(wrong => {\n    reportText += `â€¢ ç¬¬${wrong.questionNumber}é¡Œï¼šæ‚¨é¸ ${wrong.userAnswer}ï¼Œæ­£è§£ ${wrong.correctAnswer}\\n`;\n    reportText += `  ä¸»é¡Œï¼š${wrong.concept}\\n`;\n  });\n  reportText += `\\n`;\n}\n\nif (suggestions.length > 0) {\n  reportText += `ğŸ’¡ å­¸ç¿’å»ºè­°ï¼š\\n`;\n  suggestions.forEach(suggestion => {\n    reportText += `â€¢ ${suggestion}\\n`;\n  });\n}\n\nreturn [{\n  json: {\n    ...userData,\n    analysis: {\n      totalQuestions,\n      correctCount,\n      wrongCount: wrongAnswers.length,\n      score,\n      grade,\n      wrongAnswers,\n      topicStats,\n      suggestions\n    },\n    reportText,\n    analysisComplete: true\n  }\n}];"
      },
      "position": [
        400,
        300
      ],
      "typeVersion": 1
    },
    {
      "id": "node_4",
      "name": "æ›´æ–°éŒ¯é¡Œçµ±è¨ˆåˆ°Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "parameters": {
        "operation": "append",
        "documentId": "1QXJ0VGe735d5aWS-aC6XHBrhg62wDIl-oqN6ybZIcg0",
        "sheetName": "ç­”é¡Œçµ±è¨ˆ",
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "ç”¨æˆ¶ID": "={{$json.userId}}",
            "ç­”é¡Œæ™‚é–“": "={{$json.timestamp}}",
            "ç¸½é¡Œæ•¸": "={{$json.analysis.totalQuestions}}",
            "æ­£ç¢ºæ•¸": "={{$json.analysis.correctCount}}",
            "ç­”å°ç‡": "={{$json.analysis.score}}",
            "ç­‰ç´š": "={{$json.analysis.grade}}",
            "éŒ¯é¡Œæ•¸": "={{$json.analysis.wrongCount}}",
            "ä¸»è¦å¼±é»": "={{$json.analysis.suggestions.join('; ')}}"
          }
        }
      },
      "position": [
        600,
        300
      ],
      "typeVersion": 1
    },
    {
      "id": "node_5",
      "name": "ç™¼é€åˆ†æå ±å‘Šåˆ°LINE",
      "type": "n8n-nodes-base.httpRequest",
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer {{$env.LINE_CHANNEL_ACCESS_TOKEN}}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\\n  \\\"replyToken\\\": \\\"{{$json.replyToken}}\\\",\\n  \\\"messages\\\": [\\n    {\\n      \\\"type\\\": \\\"text\\\",\\n      \\\"text\\\": \\\"{{$json.reportText.replace(/\\\\n/g, '\\\\\\\\n');}}\\\"\\n    }\\n  ]\\n}"
      },
      "position": [
        800,
        300
      ],
      "typeVersion": 1
    },
    {
      "id": "node_6",
      "name": "è§¸ç™¼é¡Œåº«åŒæ­¥",
      "type": "n8n-nodes-base.httpRequest",
      "parameters": {
        "method": "POST",
        "url": "{{$env.N8N_WEBHOOK_URL}}/webhook/trigger-github-sync",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\\n  \\\"source\\\": \\\"line_analysis\\\",\\n  \\\"timestamp\\\": \\\"{{$json.timestamp}}\\\",\\n  \\\"trigger_reason\\\": \\\"ç­”é¡Œåˆ†æå®Œæˆï¼Œè§¸ç™¼é¡Œåº«åŒæ­¥\\\"\\n}"
      },
      "position": [
        1000,
        300
      ],
      "typeVersion": 1
    }
  ],
  "connections": {
    "LINEéŒ¯é¡Œåˆ†ææ¥æ”¶": {
      "main": [
        [
          {
            "node": "è§£æç­”é¡Œçµæœ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è§£æç­”é¡Œçµæœ": {
      "main": [
        [
          {
            "node": "åˆ†æéŒ¯é¡Œä¸¦ç”Ÿæˆå ±å‘Š",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åˆ†æéŒ¯é¡Œä¸¦ç”Ÿæˆå ±å‘Š": {
      "main": [
        [
          {
            "node": "æ›´æ–°éŒ¯é¡Œçµ±è¨ˆåˆ°Sheets",
            "type": "main",
            "index": 0
          },
          {
            "node": "è§¸ç™¼é¡Œåº«åŒæ­¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ›´æ–°éŒ¯é¡Œçµ±è¨ˆåˆ°Sheets": {
      "main": [
        [
          {
            "node": "ç™¼é€åˆ†æå ±å‘Šåˆ°LINE",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": null,
  "pinData": null,
  "versionId": "f667c97b-a9ff-4b58-8695-a113a6079ff3",
  "triggerCount": 1,
  "shared": [
    {
      "updatedAt": "2025-07-01T16:47:38.743Z",
      "createdAt": "2025-07-01T16:47:38.743Z",
      "role": "workflow:owner",
      "workflowId": "4BF1Q121wJzvRKsn",
      "projectId": "4W71QCd0cKKsiKSS"
    }
  ],
  "tags": []
}