{
  "name": "æ¥­å‹™ç³»çµ±",
  "nodes": [
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "69d9b57c-405f-4070-87cc-11ae650b4fa2",
              "leftValue": "={{ $json['æ›è­‰å¹´'] }}",
              "rightValue": 11606,
              "operator": {
                "type": "number",
                "operation": "lt"
              }
            },
            {
              "id": "a2dd58ff-5092-4e0b-8200-f5e1af812690",
              "leftValue": "={{ $json['æ›è­‰å¹´'] }}",
              "rightValue": "",
              "operator": {
                "type": "number",
                "operation": "notEmpty",
                "singleValue": true
              }
            },
            {
              "id": "84d6c7f8-5e16-4171-8b58-86ecb2610b05",
              "leftValue": "={{ $json['æ›è­‰å¹´'] }}",
              "rightValue": 11412,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.3,
      "position": [
        -1264,
        16
      ],
      "id": "941848a2-318f-4014-b918-fbeb0ec247e0",
      "name": "11412 < X <11606"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -1040,
        16
      ],
      "id": "1ad63e45-616c-4a50-8db8-59139a83c200",
      "name": "Loop Over Items"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "name": "Replace Me",
      "typeVersion": 1,
      "position": [
        -144,
        -64
      ],
      "id": "2ea50ae6-1446-478d-811c-59e05786d123"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "730e8dee-0b13-4747-9da9-ce0c1c873492",
              "leftValue": "={{ $json.uniformno }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -592,
        -128
      ],
      "id": "968f0f60-d759-40d7-a172-92063f141716",
      "name": "If"
    },
    {
      "parameters": {
        "useCustomSchema": true,
        "tableId": "factories",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "emsno",
              "fieldValue": "={{ $('Loop Over Items').item.json.emsno }}"
            },
            {
              "fieldId": "uniformno",
              "fieldValue": "={{ $('Loop Over Items').item.json.uniformno }}"
            },
            {
              "fieldId": "facilityname",
              "fieldValue": "={{ $('Loop Over Items').item.json.facilityname }}"
            },
            {
              "fieldId": "facilityaddress",
              "fieldValue": "={{ $('Loop Over Items').item.json.facilityaddress }}"
            },
            {
              "fieldId": "industryareaname",
              "fieldValue": "={{ $('Loop Over Items').item.json.industryareaname }}"
            },
            {
              "fieldId": "industryid",
              "fieldValue": "={{ $('Loop Over Items').item.json.industryid }}"
            },
            {
              "fieldId": "industryname",
              "fieldValue": "={{ $('Loop Over Items').item.json.industryname }}"
            },
            {
              "fieldId": "isair",
              "fieldValue": "={{ $('Loop Over Items').item.json.isair }}"
            },
            {
              "fieldId": "iswater",
              "fieldValue": "={{ $('Loop Over Items').item.json.iswater }}"
            },
            {
              "fieldId": "iswaste",
              "fieldValue": "={{ $('Loop Over Items').item.json.iswaste }}"
            },
            {
              "fieldId": "istoxic",
              "fieldValue": "={{ $('Loop Over Items').item.json.istoxic }}"
            },
            {
              "fieldId": "issoil",
              "fieldValue": "={{ $('Loop Over Items').item.json.issoil }}"
            },
            {
              "fieldId": "consultant_company",
              "fieldValue": "={{ $('Loop Over Items').item.json[\"é¡§å•å…¬å¸\"] }}"
            },
            {
              "fieldId": "phone",
              "fieldValue": "={{ $('Loop Over Items').item.json[\"é›»è©±\"] }}"
            },
            {
              "fieldId": "renewal_year",
              "fieldValue": "={{ $('Loop Over Items').item.json[\"æ›è­‰å¹´\"] }}"
            },
            {
              "fieldId": "notes",
              "fieldValue": "={{ $('Loop Over Items').item.json[\"å‚™è¨»\"] }}"
            },
            {
              "fieldId": "scheduled_date",
              "fieldValue": "={{ $('Loop Over Items').item.json[\"é è¨ˆæ’ç¨‹\"] }}"
            },
            {
              "fieldId": "result",
              "fieldValue": "={{ $('Loop Over Items').item.json[\"çµæœ\"] }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -368,
        -128
      ],
      "id": "8e80d308-ee59-4859-903c-0cd5f0579045",
      "name": "ä¸€å€‹ä¸€å€‹æ–°å¢",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "factories",
        "filters": {
          "conditions": [
            {
              "keyName": "uniformno",
              "keyValue": "={{ $json.uniformno }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -816,
        -128
      ],
      "id": "f7c33989-d092-4bcb-8060-07961c4b3899",
      "name": "å–å¾—è©²çµ±ç·¨æ˜¯å¦å·²å­˜åœ¨",
      "alwaysOutputData": true,
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -1280,
        3984
      ],
      "id": "fbfbc60d-3964-420f-8ffe-7febefa1e9c5",
      "name": "Loop Over Items1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "name": "Replace Me1",
      "typeVersion": 1,
      "position": [
        -1040,
        3984
      ],
      "id": "deefb5f6-0ea6-4761-94a0-183b1627348b"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "730e8dee-0b13-4747-9da9-ce0c1c873492",
              "leftValue": "={{ $json.ban }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -640,
        4032
      ],
      "id": "423df5ea-b26d-4142-8414-4cf2f14e2082",
      "name": "If1"
    },
    {
      "parameters": {
        "useCustomSchema": true,
        "tableId": "water_permits",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "ems_no",
              "fieldValue": "={{ $('æ°´è¨±å¯').item.json.ems_no }}"
            },
            {
              "fieldId": "ban",
              "fieldValue": "={{ $('æ°´è¨±å¯').item.json.ban }}"
            },
            {
              "fieldId": "fac_name",
              "fieldValue": "={{ $('æ°´è¨±å¯').item.json.fac_name }}"
            },
            {
              "fieldId": "per_no",
              "fieldValue": "={{ $('æ°´è¨±å¯').item.json.per_no }}"
            },
            {
              "fieldId": "per_sdate",
              "fieldValue": "={{ $('æ°´è¨±å¯').item.json.per_sdate }}"
            },
            {
              "fieldId": "per_edate",
              "fieldValue": "={{ $('æ°´è¨±å¯').item.json.per_edate }}"
            },
            {
              "fieldId": "per_type",
              "fieldValue": "={{ $('æ°´è¨±å¯').item.json.per_type }}"
            },
            {
              "fieldId": "address",
              "fieldValue": "={{ $('æ°´è¨±å¯').item.json.address }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -400,
        4096
      ],
      "id": "686f653d-5d5a-4e93-8f9d-e4ad5919ea4a",
      "name": "ä¸€å€‹ä¸€å€‹æ–°å¢1",
      "executeOnce": false,
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "water_permits",
        "filters": {
          "conditions": [
            {
              "keyName": "ems_no",
              "keyValue": "={{ $json.ems_no }}"
            },
            {
              "keyName": "ban",
              "keyValue": "={{ $json.ban }}"
            },
            {
              "keyName": "fac_name",
              "keyValue": "={{ $json.fac_name }}"
            },
            {
              "keyName": "per_no",
              "keyValue": "={{ $json.per_no }}"
            },
            {
              "keyName": "per_sdate",
              "keyValue": "={{ $json.per_sdate }}"
            },
            {
              "keyName": "per_edate",
              "keyValue": "={{ $json.per_edate }}"
            },
            {
              "keyName": "per_type",
              "keyValue": "={{ $json.per_type }}"
            },
            {
              "keyName": "address",
              "keyValue": "={{ $json.address }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -832,
        4000
      ],
      "id": "abbd8384-0602-4a20-8370-31c4ad93bf99",
      "name": "å–å¾—è©²çµ±ç·¨æ˜¯å¦å·²å­˜åœ¨1",
      "alwaysOutputData": true,
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1MeVmMZYOjrXAlTBlDIc7VoM30HuG1MufUgSPJpEEOvI",
          "mode": "list",
          "cachedResultName": "ç’°å¢ƒä¿è­·è¨±å¯ç®¡ç†ç³»çµ±",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MeVmMZYOjrXAlTBlDIc7VoM30HuG1MufUgSPJpEEOvI/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1707054240,
          "mode": "list",
          "cachedResultName": "æ°´è¨±å¯è³‡æ–™ (å·²åˆä½µ)",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MeVmMZYOjrXAlTBlDIc7VoM30HuG1MufUgSPJpEEOvI/edit#gid=1707054240"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Status"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1504,
        3984
      ],
      "id": "c954c2c9-433e-487c-b81f-13cbc7baefad",
      "name": "æ°´è¨±å¯",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1MeVmMZYOjrXAlTBlDIc7VoM30HuG1MufUgSPJpEEOvI",
          "mode": "list",
          "cachedResultName": "ç’°å¢ƒä¿è­·è¨±å¯ç®¡ç†ç³»çµ±",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MeVmMZYOjrXAlTBlDIc7VoM30HuG1MufUgSPJpEEOvI/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1707054240,
          "mode": "list",
          "cachedResultName": "æ°´è¨±å¯è³‡æ–™ (å·²åˆä½µ)",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MeVmMZYOjrXAlTBlDIc7VoM30HuG1MufUgSPJpEEOvI/edit#gid=1707054240"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "ban": "={{ $json.ban }}",
            "Status": "done"
          },
          "matchingColumns": [
            "ban"
          ],
          "schema": [
            {
              "id": "ems_no",
              "displayName": "ems_no",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fac_name",
              "displayName": "fac_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "address",
              "displayName": "address",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ban",
              "displayName": "ban",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "per_no",
              "displayName": "per_no",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "per_sdate",
              "displayName": "per_sdate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "per_edate",
              "displayName": "per_edate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "per_type",
              "displayName": "per_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "emi_sdate",
              "displayName": "emi_sdate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "emi_edate",
              "displayName": "emi_edate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "emi_waterunit",
              "displayName": "emi_waterunit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "emi_item",
              "displayName": "emi_item",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -112,
        4176
      ],
      "id": "ad2b3f73-28f5-4c00-8912-e4c4217ed85f",
      "name": "Update row in sheet",
      "credentials": "[REMOVED]",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 10
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        240,
        4336
      ],
      "id": "3f692393-f00f-468a-a87a-2870ee27f406",
      "name": "Wait",
      "webhookId": "[REMOVED]"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "97e2d355-ceb8-4748-9c4d-d64b3d7e2715",
              "leftValue": "={{ $json.error }}",
              "rightValue": "The 'Column to Match On' parameter is required",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        64,
        3840
      ],
      "id": "24d012a9-19be-4b05-8d16-576b8dabe727",
      "name": "If2"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1MeVmMZYOjrXAlTBlDIc7VoM30HuG1MufUgSPJpEEOvI",
          "mode": "list",
          "cachedResultName": "ç’°å¢ƒä¿è­·è¨±å¯ç®¡ç†ç³»çµ±",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MeVmMZYOjrXAlTBlDIc7VoM30HuG1MufUgSPJpEEOvI/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1707054240,
          "mode": "list",
          "cachedResultName": "æ°´è¨±å¯è³‡æ–™ (å·²åˆä½µ)",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MeVmMZYOjrXAlTBlDIc7VoM30HuG1MufUgSPJpEEOvI/edit#gid=1707054240"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "ems_no": "={{ $('ä¸€å€‹ä¸€å€‹æ–°å¢1').item.json.ems_no }}",
            "Status": "done"
          },
          "matchingColumns": [
            "ems_no"
          ],
          "schema": [
            {
              "id": "ems_no",
              "displayName": "ems_no",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fac_name",
              "displayName": "fac_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "address",
              "displayName": "address",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ban",
              "displayName": "ban",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "per_no",
              "displayName": "per_no",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "per_sdate",
              "displayName": "per_sdate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "per_edate",
              "displayName": "per_edate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "per_type",
              "displayName": "per_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "emi_sdate",
              "displayName": "emi_sdate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "emi_edate",
              "displayName": "emi_edate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "emi_waterunit",
              "displayName": "emi_waterunit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "emi_item",
              "displayName": "emi_item",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        288,
        3936
      ],
      "id": "a40e9d3d-30e4-460c-ae51-03357f2b0642",
      "name": "Update row in sheet1",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1MeVmMZYOjrXAlTBlDIc7VoM30HuG1MufUgSPJpEEOvI",
          "mode": "list",
          "cachedResultName": "ç’°å¢ƒä¿è­·è¨±å¯ç®¡ç†ç³»çµ±",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MeVmMZYOjrXAlTBlDIc7VoM30HuG1MufUgSPJpEEOvI/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1793317228,
          "mode": "list",
          "cachedResultName": "æ¯’åŒ–ç‰©è¨±å¯",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MeVmMZYOjrXAlTBlDIc7VoM30HuG1MufUgSPJpEEOvI/edit#gid=1793317228"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Status"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1264,
        3776
      ],
      "id": "2f79a2ba-89a3-4bf7-ab1e-bc42f76998fb",
      "name": "æ¯’è¨±å¯",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -144,
        3760
      ],
      "id": "34860306-18a3-40da-8783-50f35eaca822",
      "name": "Loop Over Items2"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "name": "Replace Me2",
      "typeVersion": 1,
      "position": [
        80,
        3680
      ],
      "id": "7c273a8d-c50c-4913-b997-bd98f6b4824f"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "730e8dee-0b13-4747-9da9-ce0c1c873492",
              "leftValue": "={{ $json.unino }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        528,
        3760
      ],
      "id": "299e2a33-bf10-4150-8979-91a6c77f0c49",
      "name": "If3"
    },
    {
      "parameters": {
        "useCustomSchema": true,
        "tableId": "toxic_permits",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "ems_no",
              "fieldValue": "={{ $('æ¯’è¨±å¯').item.json.ems_no }}"
            },
            {
              "fieldId": "unino",
              "fieldValue": "={{ $('æ¯’è¨±å¯').item.json.unino }}"
            },
            {
              "fieldId": "fac_name",
              "fieldValue": "={{ $('æ¯’è¨±å¯').item.json.fac_name }}"
            },
            {
              "fieldId": "per_no",
              "fieldValue": "={{ $('æ¯’è¨±å¯').item.json.per_no }}"
            },
            {
              "fieldId": "sdate",
              "fieldValue": "={{ $('æ¯’è¨±å¯').item.json.sdate }}"
            },
            {
              "fieldId": "edate",
              "fieldValue": "={{ $('æ¯’è¨±å¯').item.json.edate }}"
            },
            {
              "fieldId": "address",
              "fieldValue": "={{ $('æ¯’è¨±å¯').item.json.address }}"
            },
            {
              "fieldId": "emi_type",
              "fieldValue": "={{ $('æ¯’è¨±å¯').item.json.emi_type }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1040,
        3856
      ],
      "id": "e58f4cb0-bf11-446f-9ecf-8ecc4c24365f",
      "name": "ä¸€å€‹ä¸€å€‹æ–°å¢2",
      "executeOnce": false,
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "toxic_permits",
        "filters": {
          "conditions": [
            {
              "keyName": "ems_no",
              "keyValue": "={{ $json.ems_no }}"
            },
            {
              "keyName": "unino",
              "keyValue": "={{ $json.unino }}"
            },
            {
              "keyName": "fac_name",
              "keyValue": "={{ $json.fac_name }}"
            },
            {
              "keyName": "per_no",
              "keyValue": "={{ $json.per_no }}"
            },
            {
              "keyName": "sdate",
              "keyValue": "={{ $json.sdate }}"
            },
            {
              "keyName": "edate",
              "keyValue": "={{ $json.edate }}"
            },
            {
              "keyName": "address",
              "keyValue": "={{ $json.address }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        304,
        3680
      ],
      "id": "e9a65700-092c-40b0-bc1c-0c46d6502d5b",
      "name": "å–å¾—è©²çµ±ç·¨æ˜¯å¦å·²å­˜åœ¨2",
      "alwaysOutputData": true,
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1MeVmMZYOjrXAlTBlDIc7VoM30HuG1MufUgSPJpEEOvI",
          "mode": "list",
          "cachedResultName": "ç’°å¢ƒä¿è­·è¨±å¯ç®¡ç†ç³»çµ±",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MeVmMZYOjrXAlTBlDIc7VoM30HuG1MufUgSPJpEEOvI/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1793317228,
          "mode": "list",
          "cachedResultName": "æ¯’åŒ–ç‰©è¨±å¯",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MeVmMZYOjrXAlTBlDIc7VoM30HuG1MufUgSPJpEEOvI/edit#gid=1793317228"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "unino": "={{ $json.unino }}",
            "Status": "done"
          },
          "matchingColumns": [
            "unino"
          ],
          "schema": [
            {
              "id": "ems_no",
              "displayName": "ems_no",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fac_name",
              "displayName": "fac_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "address",
              "displayName": "address",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "unino",
              "displayName": "unino",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "emi_type",
              "displayName": "emi_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "per_no",
              "displayName": "per_no",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sdate",
              "displayName": "sdate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "edate",
              "displayName": "edate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "emi_item",
              "displayName": "emi_item",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -816,
        3856
      ],
      "id": "5f9077d5-d933-4a68-bf9a-f4f8c6f58b5c",
      "name": "Update row in sheet2",
      "credentials": "[REMOVED]",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 10
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -368,
        3760
      ],
      "id": "1b001b7e-f6de-49e2-b1ae-b70f47741ce4",
      "name": "Wait1",
      "webhookId": "[REMOVED]"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "97e2d355-ceb8-4748-9c4d-d64b3d7e2715",
              "leftValue": "={{ $json.error }}",
              "rightValue": "The 'Column to Match On' parameter is required",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -592,
        3952
      ],
      "id": "4f4000b2-739e-48d0-88f4-1c96ea589346",
      "name": "If4"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1MeVmMZYOjrXAlTBlDIc7VoM30HuG1MufUgSPJpEEOvI",
          "mode": "list",
          "cachedResultName": "ç’°å¢ƒä¿è­·è¨±å¯ç®¡ç†ç³»çµ±",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MeVmMZYOjrXAlTBlDIc7VoM30HuG1MufUgSPJpEEOvI/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1793317228,
          "mode": "list",
          "cachedResultName": "æ¯’åŒ–ç‰©è¨±å¯",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MeVmMZYOjrXAlTBlDIc7VoM30HuG1MufUgSPJpEEOvI/edit#gid=1793317228"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "ems_no": "={{ $('æ¯’è¨±å¯').item.json.ems_no }}",
            "Status": "done"
          },
          "matchingColumns": [
            "ems_no"
          ],
          "schema": [
            {
              "id": "ems_no",
              "displayName": "ems_no",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fac_name",
              "displayName": "fac_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "address",
              "displayName": "address",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ban",
              "displayName": "ban",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "per_no",
              "displayName": "per_no",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "per_sdate",
              "displayName": "per_sdate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "per_edate",
              "displayName": "per_edate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "per_type",
              "displayName": "per_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "emi_sdate",
              "displayName": "emi_sdate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "emi_edate",
              "displayName": "emi_edate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "emi_waterunit",
              "displayName": "emi_waterunit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "emi_item",
              "displayName": "emi_item",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -368,
        3952
      ],
      "id": "839bf32e-80a5-4f4e-8e02-28a8f584534c",
      "name": "Update row in sheet3",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -1488,
        3776
      ],
      "id": "22405350-2f3e-4952-86db-803d869e892d",
      "name": "When clicking â€˜Execute workflowâ€™"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "self-line",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -2448,
        2096
      ],
      "id": "8b0a9471-c978-434c-b452-50c88f0d9655",
      "name": "Webhook",
      "webhookId": "[REMOVED]"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst results = [];\n\nfor (const item of items) {\n  const data = item.json;\n  const alerts = [];\n  \n  // 1. å®šç¾©è¦æª¢æŸ¥çš„å¤©æ•¸æé†’ï¼ˆå°æ‡‰ line_clients çš„é€šçŸ¥è¨­å®šï¼‰\n  const enabledDays = {\n    180: data.notify_180,\n    90: data.notify_90,\n    30: data.notify_30,\n    7: data.notify_7\n  };\n  \n  // åŠ©æ‰‹å‡½æ•¸ï¼šæª¢æŸ¥ç‰¹å®šè¨±å¯è­‰æ˜¯å¦éœ€è¦ç™¼é€é€šçŸ¥\n  const checkAlert = (type, days, date, displayName) => {\n    // åªæœ‰ç•¶å¤©æ•¸æ­£å¥½å‘½ä¸­é–‹å•Ÿçš„è¨­å®šå€¼æ™‚æ‰ç™¼é€ (æˆ–å°æ–¼ç­‰æ–¼7å¤©ä¸”é–‹å•Ÿäº†7å¤©é€šçŸ¥)\n    if (days !== null && days < 200) {\n      alerts.push({\n        type: displayName,\n        days: days,\n        date: date || 'å¾…ç¢ºèª'\n      });\n    }\n  };\n\n  // 2. æª¢æŸ¥å„é …è¨±å¯è­‰ (ä½¿ç”¨ Supabase å›å‚³çš„æ–°æ¬„ä½åç¨±)\n  \n  // ç©ºæ±¡\n  checkAlert('air', data.air_days_left, data.air_expiry_date, 'ğŸŒ¬ï¸ ç©ºæ±¡è¨±å¯');\n  \n  // æ°´æ±¡\n  checkAlert('water', data.water_days_left, data.water_expiry_date, 'ğŸ’§ æ°´æ±¡è¨±å¯');\n  \n  // æ¯’åŒ–ç‰©\n  checkAlert('toxic', data.toxic_days_left, data.toxic_expiry_date, 'â˜ ï¸ æ¯’åŒ–ç‰©è¨±å¯');\n  \n  // 3. æœ‰éœ€è¦é€šçŸ¥çš„é …ç›®æ‰ç”¢ç”Ÿè¨Šæ¯\n  if (alerts.length > 0) {\n    let message = `âš ï¸ è¨±å¯è­‰åˆ°æœŸæé†’\\n\\nğŸ“‹ ${data.fac_name}\\n`;\n    \n    for (const alert of alerts) {\n      // æ ¹æ“šå¤©æ•¸åŠ ä¸Šç‹€æ…‹ç‡ˆè™Ÿ\n      const urgency = alert.days <= 30 ? 'ğŸ”´' : alert.days <= 90 ? 'ğŸŸ¡' : 'ğŸŸ¢';\n      message += `\\n${alert.type}\\n${urgency} ${alert.days} å¤©å¾Œåˆ°æœŸ (${alert.date})`;\n    }\n    \n    message += `\\n\\nè«‹å„˜æ—©è¾¦ç†å±•å»¶ï¼\\nğŸ“ å®¢æœç†±ç·šï¼š(02)6609-5888`;\n    \n    results.push({\n      json: {\n        to: data.line_user_id,\n        message: message,\n        fac_name: data.fac_name // ç•™è‘—å‚™æŸ¥\n      }\n    });\n  }\n}\n\nreturn results;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -816,
        784
      ],
      "id": "e20cc3b0-93c7-43c4-b8a2-d85ca5aaa282",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "operation": "send",
        "to": "={{ $json.to }}",
        "messages": {
          "values": [
            {
              "text": "={{ $json.message }}"
            }
          ]
        }
      },
      "type": "@aotoki/n8n-nodes-line-messaging.lineMessaging",
      "typeVersion": 1,
      "position": [
        -592,
        784
      ],
      "id": "227a1ab9-0529-4949-abe5-574ebbd50b6e",
      "name": "Line Messaging",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://yeimehdcguwnwzkmopsu.supabase.co/rest/v1/rpc/get_expiring_permits",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InllaW1laGRjZ3V3bnd6a21vcHN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzI5MTQsImV4cCI6MjA4MTA0ODkxNH0.OhQlheFmhJSoY-2U5OGPQQszSndZ0aHGBt-zsHOq0U4"
            },
            {
              "name": "Authorization",
              "value": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InllaW1laGRjZ3V3bnd6a21vcHN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzI5MTQsImV4cCI6MjA4MTA0ODkxNH0.OhQlheFmhJSoY-2U5OGPQQszSndZ0aHGBt-zsHOq0U4"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -1264,
        688
      ],
      "id": "079ac24e-71aa-41b0-a3e3-838486c1145c",
      "name": "ä¸»å‹•æŸ¥è©¢æ˜¯å¦å¿«åˆ°æœŸ"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "1d2fe236-fa54-4ed9-9020-bba7811c0840",
                    "leftValue": "={{ $json.body.events[0].message.text }}",
                    "rightValue": "^\\d{8}$",
                    "operator": {
                      "type": "string",
                      "operation": "regex"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ç¶å®šæµç¨‹"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.events[0].message.text }}",
                    "rightValue": "æŸ¥è©¢è¨±å¯è­‰",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "501af31b-9476-48cf-8ef7-1feb5bca7e13"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "æŸ¥è©¢è¨±å¯è­‰"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "1ab8d569-9a9f-4df2-827c-a7563638e756",
                    "leftValue": "={{ $json.body.events[0].message.text }}",
                    "rightValue": "æŸ¥è©¢å ±åƒ¹å–®",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "æŸ¥è©¢å ±åƒ¹å–®"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "5c70778c-4618-4955-800b-2e683d696963",
                    "leftValue": "={{ $json.body.events[0].message.text }}",
                    "rightValue": "è¯çµ¡é¡§å•",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "è¯çµ¡é¡§å•"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "502d3d1d-2772-4353-ad15-40591ef36d43",
                    "leftValue": "={{ $json.body.events[0].message.text }}",
                    "rightValue": "ç”³å ±æŸ¥è©¢",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ç”³å ±æŸ¥è©¢"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "adfa8fba-c46a-4479-9e69-67a43856ab95",
                    "leftValue": "={{ $json.body.events[0].message.text }}",
                    "rightValue": "æ¡ˆä»¶é€²åº¦",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "æ¡ˆä»¶é€²åº¦"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "5e526ac7-b462-4651-89a9-540661d6b0e2",
                    "leftValue": "={{ $json.body.events[0].message.text }}",
                    "rightValue": "æœ€æ–°æ¶ˆæ¯",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "æœ€æ–°æ¶ˆæ¯"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "3f228460-b9b2-4fd0-98a4-8d3cad043aa2",
                    "leftValue": "",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "æŸ¥è©¢å–®ä¸€å ±åƒ¹å–®"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -1936,
        2064
      ],
      "id": "5ca0d0d8-bed3-4167-a40b-a366d6104a99",
      "name": "Switch"
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\nconst replyToken = $('Webhook').first().json.body.events[0].replyToken;\n\n// ç‹€æ…‹æ ¼å¼åŒ–\nfunction formatStatus(days) {\n  if (days === null) return 'âšª ç„¡è³‡æ–™';\n  if (days < 0) return 'â›” å·²éæœŸ';\n  if (days <= 30) return `ğŸ”´ ${days}å¤©`;\n  if (days <= 90) return `ğŸŸ¡ ${days}å¤©`;\n  if (days <= 180) return `ğŸŸ¢ ${days}å¤©`;\n  return `âœ… ${days}å¤©`;\n}\n\n// çµ„åˆè¨Šæ¯\nlet message = `ğŸ“‹ ${data.client_name} \nè¨±å¯è­‰ç‹€æ…‹\\n`;\nmessage += `â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\n\nif (data.has_air && data.air_expiry) {\n  message += `ğŸŒ¬ï¸ ç©ºæ±¡ï¼š${formatStatus(data.air_days_left)}\\n`;\n  message += `   åˆ°æœŸï¼š${data.air_expiry}\\n`;\n}\n\nif (data.has_water && data.water_expiry) {\n  message += `ğŸ’§ æ°´æ±¡ï¼š${formatStatus(data.water_days_left)}\\n`;\n  message += `   åˆ°æœŸï¼š${data.water_expiry}\\n`;\n}\n\nif (data.has_waste && data.waste_expiry) {\n  message += `ğŸ—‘ï¸ å»¢æ£„ç‰©ï¼š${formatStatus(data.waste_days_left)}\\n`;\n  message += `   åˆ°æœŸï¼š${data.waste_expiry}\\n`;\n}\n\nif (data.has_toxic && data.toxic_expiry) {\n  message += `â˜ ï¸ æ¯’åŒ–ç‰©ï¼š${formatStatus(data.toxic_days_left)}\\n`;\n  message += `   åˆ°æœŸï¼š${data.toxic_expiry}\\n`;\n}\n\nmessage += `â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\nmessage += `ğŸ“ è¯ç¹«é¡§å•ï¼š(02)6609-5888`;\n\nreturn {\n  replyToken,\n  message\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -592,
        1616
      ],
      "id": "9b89e46a-3910-4f26-af66-b2700e5321ff",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "operation": "send",
        "to": "={{ $('Webhook').item.json.body.events[0].source.userId }}",
        "messages": {
          "values": [
            {
              "text": "={{ $json.message }}"
            }
          ]
        }
      },
      "type": "@aotoki/n8n-nodes-line-messaging.lineMessaging",
      "typeVersion": 1,
      "position": [
        -368,
        1616
      ],
      "id": "bc77645b-6d32-4ee8-a6b9-0edf4fddbbc9",
      "name": "Line Messaging1",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://yeimehdcguwnwzkmopsu.supabase.co/rest/v1/rpc/get_my_permits",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InllaW1laGRjZ3V3bnd6a21vcHN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzI5MTQsImV4cCI6MjA4MTA0ODkxNH0.OhQlheFmhJSoY-2U5OGPQQszSndZ0aHGBt-zsHOq0U4"
            },
            {
              "name": "Authorization",
              "value": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InllaW1laGRjZ3V3bnd6a21vcHN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzI5MTQsImV4cCI6MjA4MTA0ODkxNH0.OhQlheFmhJSoY-2U5OGPQQszSndZ0aHGBt-zsHOq0U4"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"target_line_user_id\": \"{{ $('Webhook').item.json.body.events[0].source.userId }}\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -1040,
        1712
      ],
      "id": "b67bef32-2231-47bb-a168-1f86db80c060",
      "name": "è¢«å‹•æŸ¥è©¢",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "operation": "send",
        "to": "={{ $('Webhook').item.json.body.events[0].source.userId }}",
        "messages": {
          "values": [
            {
              "text": "=æ‚¨å¥½ï¼æ„Ÿè¬æ‚¨çš„è«®è©¢ã€‚\nå‚‘å¤ªç’°å¢ƒå·¥ç¨‹åœ˜éšŠ\n\néš¨æ™‚ç‚ºæ‚¨æœå‹™ï¼š\nğŸ‘· å°ˆæ¥­æŠ€å¸«ï¼šæå…ˆç”Ÿ (åˆ†æ©Ÿ 100) \nğŸ‘©â€ğŸ’¼ è«‹æ¬¾è²¡å‹™ï¼šèˆ’å°å§ (åˆ†æ©Ÿ 101) \nğŸ“ å ±å‘Šç–‘æ…®ï¼šè”¡å°å§ (åˆ†æ©Ÿ 102) \nğŸ’¼ æ¥­å‹™æ´½è©¢ï¼šå¼µå…ˆç”Ÿ (åˆ†æ©Ÿ 103)\nğŸ“ ç¸½æ©Ÿå°ˆç·šï¼š02-6609-5888 \n\nğŸ“§ å…¬å¸ä¿¡ç®±ï¼šjetenv92662049@gmail.com\nğŸ“§ æ¥­å‹™ä¿¡ç®±ï¼šJetenv02@gmail.com\n\nğŸŒ å®˜æ–¹ç¶²ç«™ï¼š\njetenv.com.tw \nğŸ§µ Threadsï¼š\nthreads.com/@jet_env_tech\n\nè‹¥æœ‰å…¶ä»–éœ€æ±‚æˆ–æƒ³é€²ä¸€æ­¥äº†è§£ï¼Œæ­¡è¿ç›´æ¥ç•™ä¸‹æ‚¨çš„ LINE ID åŠ å•é¡Œï¼Œæˆ‘å€‘å°‡ç”±å°ˆäººèˆ‡æ‚¨è¯çµ¡ï¼"
            }
          ]
        }
      },
      "type": "@aotoki/n8n-nodes-line-messaging.lineMessaging",
      "typeVersion": 1,
      "position": [
        -1040,
        2288
      ],
      "id": "c4ba709d-a3e1-4e4c-ad8a-025add5774c2",
      "name": "Line Messaging3",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "replyToken": "={{ $json.replyToken }}",
        "messages": {
          "values": [
            {
              "text": "={{ $json.message }}"
            }
          ]
        }
      },
      "type": "@aotoki/n8n-nodes-line-messaging.lineMessaging",
      "typeVersion": 1,
      "position": [
        -592,
        2480
      ],
      "id": "a975288e-5cf1-412e-a905-4dc48fbbda69",
      "name": "Line Messaging4",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://yeimehdcguwnwzkmopsu.supabase.co/rest/v1/rpc/get_monthly_regulations",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InllaW1laGRjZ3V3bnd6a21vcHN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzI5MTQsImV4cCI6MjA4MTA0ODkxNH0.OhQlheFmhJSoY-2U5OGPQQszSndZ0aHGBt-zsHOq0U4"
            },
            {
              "name": "Authorization",
              "value": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InllaW1laGRjZ3V3bnd6a21vcHN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzI5MTQsImV4cCI6MjA4MTA0ODkxNH0.OhQlheFmhJSoY-2U5OGPQQszSndZ0aHGBt-zsHOq0U4"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={ \"target_month\": 1 }",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -1040,
        2480
      ],
      "id": "98808946-b0db-4f68-bf5b-e8c11a00a507",
      "name": "ç”³å ±æŸ¥è©¢",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "const data = $input.all()[0].json;\nconst replyToken = $('Webhook').first().json.body.events[0].replyToken;\n\nconst currentMonth = new Date().getMonth() + 1;\nconst nextMonth = currentMonth === 12 ? 1 : currentMonth + 1;\n\n// ç”³å ±è³‡æ–™ï¼ˆç¡¬ç·¨ç¢¼ç‰ˆï¼Œä¹Ÿå¯å¾ Supabase æŸ¥è©¢ï¼‰\nconst regulations = {\n  1: [\n    { cat: 'ğŸ’¨', item: 'ç©ºæ±¡è²»å­£å ±', deadline: '1æœˆåº•' },\n    { cat: 'ğŸ’§', item: 'å»¢æ°´æª¢æ¸¬ç”³å ±', deadline: '1æœˆåº•' },\n    { cat: 'ğŸ’§', item: 'æ°´æ±¡è²»ç”³å ±', deadline: '1æœˆåº•' },\n    { cat: 'â˜¢ï¸', item: 'æ¯’åŒ–ç‰©é‹ä½œç´€éŒ„', deadline: 'æ¯æœˆ' },\n    { cat: 'ğŸ—‘ï¸', item: 'è²¯å­˜é‡æœˆç”³å ±', deadline: '5æ—¥å‰' },\n    { cat: 'ğŸŒ', item: 'åœŸå£¤æ°£é«”ç›£æ¸¬', deadline: '1æœˆåº•' },\n    { cat: 'ğŸ­', item: 'å±éšªç‰©å“ç”³å ±', deadline: '1æœˆ' }\n  ],\n  2: [\n    { cat: 'â˜¢ï¸', item: 'æ¯’åŒ–ç‰©é‹ä½œç´€éŒ„', deadline: 'æ¯æœˆ' },\n    { cat: 'ğŸ—‘ï¸', item: 'è²¯å­˜é‡æœˆç”³å ±', deadline: '5æ—¥å‰' }\n  ],\n  // ... å…¶ä»–æœˆä»½\n};\n\nfunction formatMonth(month, items) {\n  if (!items || items.length === 0) return '  âœ… æœ¬æœˆç„¡ç”³å ±é …ç›®\\n';\n  return items.map(r => `  ${r.cat} ${r.item} â°${r.deadline}`).join('\\n') + '\\n';\n}\n\nlet message = `ğŸ“‹ ç”³å ±è¡Œäº‹æ›†\\n`;\nmessage += `â”â”â”â”â”â”â”â”â”â”â”â”\\n\\n`;\nmessage += `ğŸ“ æœ¬æœˆ (${currentMonth}æœˆ)\\n`;\nmessage += formatMonth(currentMonth, regulations[currentMonth]);\nmessage += `\\nğŸ“ ä¸‹æœˆé å‘Š (${nextMonth}æœˆ)\\n`;\nmessage += formatMonth(nextMonth, regulations[nextMonth]);\nmessage += `\\nâ”â”â”â”â”â”â”â”â”â”â”â”\\n`;\nmessage += `ï¿½ éœ€è¦ä»£è¾¦ï¼Ÿè¯ç¹«æˆ‘å€‘ï¼\\n`;\nmessage += `ğŸ“ (02)6609-5888`;\n\nreturn { replyToken, message };"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -816,
        2480
      ],
      "id": "828f5bf4-ba7f-4990-9ea6-6774011acbf2",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "operation": "showLoadingAnimation",
        "chatId": "={{ $json.body.events[0].source.userId }}",
        "loadingSeconds": 30
      },
      "type": "@aotoki/n8n-nodes-line-messaging.lineMessaging",
      "typeVersion": 1,
      "position": [
        -1936,
        1856
      ],
      "id": "478445ba-2980-4a74-a016-780cbfe20407",
      "name": "Line Messaging5",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "jsCode": "const text = $json.body.events[0].message.text || \"\";\nconst regex = /(J-\\d{2}-\\d{5})[\\s,]+(\\d{8})/i;\nconst match = text.match(regex);\nif (match) {\n  return { isBindingInput: true, quoteNumber: match[1].toUpperCase(), taxId: match[2] };\n} else {\n  return { isBindingInput: false };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1488,
        1104
      ],
      "id": "725f8da1-39a2-48c3-a0e5-b41b765e79b1",
      "name": "1. è§£æç¶å®šè¼¸å…¥"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "getAll",
        "projectId": "jetenv-a82bc",
        "collection": "=artifacts/jietai-prod/public/data/quotations"
      },
      "type": "n8n-nodes-base.googleFirebaseCloudFirestore",
      "typeVersion": 1.1,
      "position": [
        -1264,
        1104
      ],
      "id": "fba2c568-850d-4575-9a2f-c937fd99dbb1",
      "name": "2. Firestore æ ¸å°è³‡æ–™",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "tableId": "line_clients",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "line_user_id",
              "fieldValue": "={{ $('Webhook').item.json.body.events[0].source.userId }}"
            },
            {
              "fieldId": "uniformno",
              "fieldValue": "={{ $node[\"1. è§£æç¶å®šè¼¸å…¥\"].json.taxId }}"
            },
            {
              "fieldId": "quote_number",
              "fieldValue": "={{ $node[\"1. è§£æç¶å®šè¼¸å…¥\"].json.quoteNumber }}"
            },
            {
              "fieldId": "fac_name",
              "fieldValue": "={{ $json.clientName }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1040,
        1104
      ],
      "id": "97406835-638d-4e74-a398-42acfa4c3e22",
      "name": "3. æ­£å¼å»ºç«‹ç¶å®š",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "operation": "send",
        "to": "={{ $('Webhook').item.json.body.events[0].source.userId }}",
        "messages": {
          "values": [
            {
              "text": "æ­å–œæ‚¨ç¶å®šæˆåŠŸï¼\nå·²ç‚ºæ‚¨é–‹é–ç›¸é—œåŠŸèƒ½\n1. æŸ¥è©¢è‡ªå·±å·¥å» è¨±å¯è­‰æœŸé™é€²åº¦\n2. æŸ¥è©¢å ±åƒ¹å–®\n3. å…¬å¸å®¢è£½åŒ–ç”³å ±è¡Œäº‹æ›†"
            }
          ]
        }
      },
      "type": "@aotoki/n8n-nodes-line-messaging.lineMessaging",
      "typeVersion": 1,
      "position": [
        560,
        1328
      ],
      "id": "f04e8422-4509-4b86-89af-229af61d91ee",
      "name": "ç¶å®šæˆåŠŸ",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "operation": "send",
        "to": "={{ $('Webhook').item.json.body.events[0].source.userId }}",
        "messages": {
          "values": [
            {
              "text": "æ‚¨å¥½ï¼Œæ­¤åŠŸèƒ½ç‚ºç¶å®šåŠŸèƒ½ï¼Œè«‹å…ˆè¡Œé€²è¡Œç¶å®šæµç¨‹æ‰èƒ½åŸ·è¡ŒæŸ¥è©¢ã€‚ \n(è¼¸å…¥ çµ±ç·¨ åŠ å ±åƒ¹å–®è™Ÿ ç”¨ä»¥æ ¸å°è³‡æ–™) \n\n è«‹å…ˆè¼¸å…¥çµ±ç·¨ï¼š"
            }
          ]
        }
      },
      "type": "@aotoki/n8n-nodes-line-messaging.lineMessaging",
      "typeVersion": 1,
      "position": [
        -592,
        2192
      ],
      "id": "0e07873a-7cfc-41b3-81db-b74010c5c0d7",
      "name": "å›å‚³ç¶å®šå°å¼•",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "line_clients",
        "filters": {
          "conditions": [
            {
              "keyName": "line_user_id",
              "keyValue": "={{ $('Webhook').item.json.body.events[0].source.userId }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1040,
        2096
      ],
      "id": "5d611adf-0707-45f2-b345-7dc1701b21b7",
      "name": "ç¢ºèªæ˜¯å¦å·²ç¶å®š",
      "alwaysOutputData": true,
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "1c22b660-6361-44f4-a65d-d4d95643b337",
              "leftValue": "={{ $json.line_user_id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -816,
        2096
      ],
      "id": "df0ceeb3-6f3e-47aa-8667-557c483928b8",
      "name": "If6"
    },
    {
      "parameters": {
        "operation": "send",
        "to": "={{ $('Webhook').item.json.body.events[0].source.userId }}",
        "messages": {
          "values": [
            {
              "text": "æ‚¨å¥½ï¼Œæ­¤åŠŸèƒ½ç‚ºç¶å®šåŠŸèƒ½ï¼Œè«‹å…ˆè¡Œé€²è¡Œç¶å®šæµç¨‹æ‰èƒ½åŸ·è¡ŒæŸ¥è©¢ã€‚ \n(è¼¸å…¥ çµ±ç·¨ åŠ å ±åƒ¹å–®è™Ÿ ç”¨ä»¥æ ¸å°è³‡æ–™) \n\n è«‹å…ˆè¼¸å…¥çµ±ç·¨ï¼š"
            }
          ]
        }
      },
      "type": "@aotoki/n8n-nodes-line-messaging.lineMessaging",
      "typeVersion": 1,
      "position": [
        -400,
        3040
      ],
      "id": "3d0c9c7f-f5a1-4444-8a4c-53bd1c420f22",
      "name": "å›å‚³ç¶å®šå°å¼•1",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "line_clients",
        "filters": {
          "conditions": [
            {
              "keyName": "line_user_id",
              "keyValue": "={{ $('Webhook').item.json.body.events[0].source.userId }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1040,
        2672
      ],
      "id": "abc9c87c-baf8-4307-9c5c-1670d13c4dc5",
      "name": "ç¢ºèªæ˜¯å¦å·²ç¶å®š1",
      "alwaysOutputData": true,
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "1c22b660-6361-44f4-a65d-d4d95643b337",
              "leftValue": "={{ $json.line_user_id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -832,
        2848
      ],
      "id": "a8c3ebe1-79cc-4d5f-8f8a-d35e701a5c90",
      "name": "If7"
    },
    {
      "parameters": {
        "jsCode": "const text = $json.body.events[0].message.text || \"\";\n// åµæ¸¬æ˜¯å¦ç‚ºç´” 8 ä½æ•¸å­— (çµ±ç·¨æ ¼å¼)\nconst regex = /^\\d{8}$/;\nif (regex.test(text.trim())) {\n  return { isTaxId: true, taxId: text.trim() };\n} else {\n  return { isTaxId: false };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1040,
        1424
      ],
      "id": "721a4176-3109-4ada-8f05-d0f1c2e7d243",
      "name": "1. åµæ¸¬çµ±ç·¨è¼¸å…¥"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "getAll",
        "projectId": "jetenv-a82bc",
        "collection": "=artifacts/jietai-prod/public/data/quotations",
        "limit": 50
      },
      "type": "n8n-nodes-base.googleFirebaseCloudFirestore",
      "typeVersion": 1.1,
      "position": [
        -816,
        1424
      ],
      "id": "b7aaa94d-1db4-478b-99f4-842e73489bed",
      "name": "2. Firestore ç¢ºèªå®¢æˆ¶èº«åˆ†",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "tableId": "line_clients",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "line_user_id",
              "fieldValue": "={{ $('Webhook').item.json.body.events[0].source.userId }}"
            },
            {
              "fieldId": "uniformno",
              "fieldValue": "={{ $('Webhook').item.json.body.events[0].message.text }}"
            },
            {
              "fieldId": "fac_name",
              "fieldValue": "={{ $('If8').item.json.clientName }}"
            },
            {
              "fieldId": "quote_number",
              "fieldValue": "={{ $('If8').item.json.quoteNumber }}"
            },
            {
              "fieldId": "line_display_name",
              "fieldValue": "={{ $json.profile.displayName }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        352,
        1328
      ],
      "id": "59572b95-32e3-4fdd-9593-6cc0e78f991a",
      "name": "3. å¿«é€Ÿå»ºç«‹ç¶å®š (Supabase)",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "9b023a7a-60d8-452a-ac6a-2efe91dd6cc5",
              "leftValue": "={{ $json.clientTaxId }}",
              "rightValue": "={{ $('1. åµæ¸¬çµ±ç·¨è¼¸å…¥').item.json.taxId }}",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -368,
        1424
      ],
      "id": "938c83ad-27b5-4db9-b375-4fe293c2e3d1",
      "name": "If8",
      "executeOnce": false
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        144,
        1328
      ],
      "id": "efc9d7c7-7c82-4d05-a292-188951d8bbef",
      "name": "Limit"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "getAll",
        "projectId": "jetenv-a82bc",
        "collection": "=artifacts/jietai-prod/public/data/quotations",
        "limit": 50
      },
      "type": "n8n-nodes-base.googleFirebaseCloudFirestore",
      "typeVersion": 1.1,
      "position": [
        -592,
        2000
      ],
      "id": "36d46c9a-9f14-4fd6-ab57-ce0b442f5070",
      "name": "2. Firestore ç¢ºèªå®¢æˆ¶èº«åˆ†1",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "quoteNumber"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -144,
        2000
      ],
      "id": "d6531332-5957-4582-9b60-c735307100ec",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "0a2108fb-6f89-4236-b954-ce425eb760aa",
              "leftValue": "={{ $('If6').item.json.uniformno }}",
              "rightValue": "={{ $json.clientTaxId }}",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.3,
      "position": [
        -368,
        2000
      ],
      "id": "2ed07cf8-cd33-4619-9865-4487cc88e9b1",
      "name": "Filter",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "// 1. å–å¾—å½™æ•´å¾Œçš„é™£åˆ—\nconst data = $input.first().json;\n// å‡è¨­æ‚¨å‰›æ‰åœ¨ Aggregate è£¡é¢è¨­å®šæ¬„ä½åç¨±ç‚º quoteNumber\nconst quotes = data.quoteNumber; \n\nif (!quotes || quotes.length === 0) {\n  return { message: \"âš ï¸ æŸ¥ç„¡å ±åƒ¹ç´€éŒ„ã€‚\" };\n}\n\n// 2. é–‹å§‹æ’ç‰ˆ\nlet message = \"ğŸ“‹ æ‚¨çš„å ±åƒ¹å–®åˆ—è¡¨ï¼š\\nâ”â”â”â”â”â”â”â”â”â”â”â”\\n\";\n\nquotes.forEach((num, index) => {\n  message += `${index + 1}. å–®è™Ÿï¼š${num}\\n`;\n});\n\nmessage += \"â”â”â”â”â”â”â”â”â”â”â”â”\\nå¦‚éœ€è©³ç´°å…§å®¹è«‹æ´½æ‰¿è¾¦äººã€‚\";\n\nreturn { message: message };"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        80,
        2000
      ],
      "id": "3b4178a6-606b-486b-8f8b-9234482423ab",
      "name": "Code in JavaScript3"
    },
    {
      "parameters": {
        "operation": "send",
        "to": "={{ $('Webhook').item.json.body.events[0].source.userId }}",
        "messages": {
          "values": [
            {
              "text": "={{ $json.message }}"
            }
          ]
        }
      },
      "type": "@aotoki/n8n-nodes-line-messaging.lineMessaging",
      "typeVersion": 1,
      "position": [
        304,
        2000
      ],
      "id": "03e6beff-49fc-4789-b4f1-5cb8bc759f4f",
      "name": "Line Messaging7",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "content": "ä¸»å‹•æŸ¥è©¢è¨±å¯è­‰æœŸæ•ˆä¸¦é€šçŸ¥",
        "height": 256,
        "width": 1056
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1632,
        688
      ],
      "typeVersion": 1,
      "id": "26b1db85-8358-4314-8815-81cda3ed6e54",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "weeks",
              "triggerAtDay": [
                1
              ],
              "triggerAtHour": 8
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        -1488,
        688
      ],
      "id": "1b36cfc2-36b1-4f4b-8eef-a98bb40dc6a7",
      "name": "Schedule Trigger1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -1056,
        768
      ],
      "id": "6bfe96b9-5ec8-4c4c-9bed-eb5a11ababba",
      "name": "Loop Over Items3"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "name": "Replace Me3",
      "typeVersion": 1,
      "position": [
        -352,
        784
      ],
      "id": "e010b50f-6b4d-4f94-a4e0-96a2ef248965"
    },
    {
      "parameters": {
        "operation": "send",
        "to": "={{ $('Webhook').item.json.body.events[0].source.userId }}",
        "messages": {
          "values": [
            {
              "text": "æŸ¥è©¢çµæœé¡¯ç¤ºï¼Œç›®å‰å°šæœªå»ºç«‹æ‚¨çš„å ±åƒ¹è³‡æ–™ã€‚\nè‹¥æ‚¨å°šæœªå–å¾—å‚‘å¤ªçš„å ±åƒ¹å–®è™Ÿï¼Œè«‹å…ˆè¯ç¹«æ‰¿è¾¦äººå“¡å®Œæˆå ±åƒ¹ä½œæ¥­å¾Œå†é€²è¡ŒæŸ¥è©¢ã€‚\nè‹¥å·²å–å¾—å ±åƒ¹å–®ï¼Œè«‹å†æ¬¡ç¢ºèªè¼¸å…¥ çµ±ç·¨ ç”¨ä»¥æ ¸å°è³‡æ–™æ˜¯å¦æ­£ç¢ºã€‚ \n\n(æ˜¯å¦å°šæœªæ”¶åˆ°å‚‘å¤ªå ±åƒ¹å–®ï¼Ÿ)\n\nè¦å•Ÿç”¨æ­¤é …åŠŸèƒ½è«‹å…ˆè«‹ å‚‘å¤ªæ‰¿è¾¦äººå“¡ å”åŠ©å ±åƒ¹\n\n\n\næ„Ÿè¬æ‚¨"
            }
          ]
        }
      },
      "type": "@aotoki/n8n-nodes-line-messaging.lineMessaging",
      "typeVersion": 1,
      "position": [
        -64,
        1488
      ],
      "id": "af117111-9e28-4014-af43-5c8d783651f4",
      "name": "ç¶å®šå¤±æ•—",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "3874d3d4-8c53-462e-bcbb-059434aa5d6d",
              "leftValue": "={{ $json.uniformno }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -816,
        1712
      ],
      "id": "c3a33db6-4251-4887-89ab-bb1cce85fe3c",
      "name": "If5"
    },
    {
      "parameters": {
        "operation": "send",
        "to": "={{ $('Webhook').item.json.body.events[0].source.userId }}",
        "messages": {
          "values": [
            {
              "text": "æ‚¨å¥½ï¼Œæ­¤åŠŸèƒ½ç‚ºç¶å®šåŠŸèƒ½ï¼Œè«‹å…ˆè¡Œé€²è¡Œç¶å®šæµç¨‹æ‰èƒ½åŸ·è¡ŒæŸ¥è©¢ã€‚ \n(è¼¸å…¥ çµ±ç·¨  ç”¨ä»¥æ ¸å°è³‡æ–™) \n\n è«‹å…ˆè¼¸å…¥çµ±ç·¨ï¼š"
            }
          ]
        }
      },
      "type": "@aotoki/n8n-nodes-line-messaging.lineMessaging",
      "typeVersion": 1,
      "position": [
        -592,
        1808
      ],
      "id": "c2991448-058a-4207-8775-875d1fa97be1",
      "name": "å›å‚³ç¶å®šå°å¼•2",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "e51fd6fe-adde-481e-83d4-494d352220ba",
              "leftValue": "={{ $('1. åµæ¸¬çµ±ç·¨è¼¸å…¥').item.json.taxId }}",
              "rightValue": "={{ $json.clientTaxId }}",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.3,
      "position": [
        -592,
        1424
      ],
      "id": "98d0c76c-2724-4279-a62b-3b4891cba06e",
      "name": "Filter1",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "operation": "getProfile",
        "userId": "={{ $('Webhook').item.json.body.events[0].source.userId }}"
      },
      "type": "@aotoki/n8n-nodes-line-messaging.lineMessaging",
      "typeVersion": 1,
      "position": [
        -64,
        1328
      ],
      "id": "178edb3b-051f-4ae2-b36e-3c96074bfbc4",
      "name": "Line Messaging2",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "operation": "send",
        "to": "={{ $('Webhook').item.json.body.events[0].source.userId }}",
        "messages": {
          "values": [
            {
              "text": "=æ‚¨å¥½ï¼æ„Ÿè¬æ‚¨çš„è«®è©¢ã€‚\nå‚‘å¤ªç’°å¢ƒå·¥ç¨‹åœ˜éšŠ\n\næ­¤åŠŸèƒ½é–‹ç™¼ä¸­ï¼Œæ•¬è«‹æœŸå¾…ï¼Œ\n\nè‹¥æœ‰å…¶ä»–éœ€æ±‚æˆ–æƒ³é€²ä¸€æ­¥äº†è§£ï¼Œæ­¡è¿ç›´æ¥ç•™ä¸‹æ‚¨çš„ LINE ID åŠ å•é¡Œï¼Œæˆ‘å€‘å°‡ç”±å°ˆäººèˆ‡æ‚¨è¯çµ¡ï¼"
            }
          ]
        }
      },
      "type": "@aotoki/n8n-nodes-line-messaging.lineMessaging",
      "typeVersion": 1,
      "position": [
        -1648,
        2432
      ],
      "id": "5f4fdd5c-27a4-4acd-9ca7-51f56bd7483d",
      "name": "Line Messaging6",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "bbca1c69-16ac-4fdc-b151-2ecfc071742b",
              "leftValue": "",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -144,
        1840
      ],
      "id": "0d8b824f-a390-4901-b83f-cc50835d918e",
      "name": "If9"
    },
    {
      "parameters": {
        "jsCode": "const lineClient = $('ç¢ºèªæ˜¯å¦å·²ç¶å®š1').first().json;\nconst client = $('æŸ¥è©¢å®¢æˆ¶é€²åº¦è³‡æ–™').first().json;\n\n// è™•ç†æ‰¾ä¸åˆ°è³‡æ–™çš„æƒ…æ³\nif (!lineClient || !lineClient.uniformno) {\n  return {\n    message: `âŒ æŸ¥ç„¡ç¶å®šè³‡æ–™\\n\\nè«‹å…ˆè¼¸å…¥çµ±ç·¨å®Œæˆç¶å®šæµç¨‹ã€‚`\n  };\n}\n\n// åŸºæœ¬è³‡è¨Š\nconst uniformno = lineClient.uniformno;\nconst facName = lineClient.fac_name || client?.name || 'æ‚¨çš„å…¬å¸';\nconst status = client?.status || 'æŸ¥è©¢ä¸­';\nconst nextAction = client?.next_action || 'è«‹æ´½æ‰¿è¾¦äºº';\nconst deadline = client?.deadline || 'å¾…ç¢ºèª';\n\n// æ‰¿è¾¦äººè³‡è¨Š\nconst officerName = client?.officer?.name || 'å‚‘å¤ªåœ˜éšŠ';\nconst officerPhone = client?.officer?.phone || '(02)6609-5888';\n\n// å°ˆå±¬é€£çµ\nconst portalUrl = `https://jetenv-sales-system.vercel.app/portal?id=${uniformno}`;\n\n// çµ„åˆè¨Šæ¯\nconst message = `ğŸ“‹ æ¡ˆä»¶é€²åº¦æŸ¥è©¢\nâ”â”â”â”â”â”â”â”â”\n\nğŸ­ ${facName}\nğŸ“Š ç›®å‰ç‹€æ…‹ï¼š${status}\nğŸ“… ä¸‹ä¸€é …å¾…è¾¦ï¼š${nextAction}\nâ° æœŸé™ï¼š${deadline}\n\nğŸ‘‡ é»æ“Šä¸‹æ–¹é€£çµæŸ¥çœ‹å®Œæ•´è³‡è¨Šï¼š\n${portalUrl}\n\nâœ¨ å¯æŸ¥çœ‹ï¼š\nâ€¢ è¨±å¯è­‰åˆ°æœŸç‹€æ…‹\nâ€¢ å°ˆæ¡ˆé€²åº¦\nâ€¢ ç”³å ±è¡Œäº‹æ›†\n\nğŸ“ æ‰¿è¾¦äººï¼š${officerName}\nâ˜ï¸ ${officerPhone}`;\n\nreturn { message };"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -368,
        2752
      ],
      "id": "6f9f269a-3b9c-450f-9bbc-715ed7c32220",
      "name": "Code in JavaScript4"
    },
    {
      "parameters": {
        "url": "https://yeimehdcguwnwzkmopsu.supabase.co/rest/v1/clients",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "select",
              "value": "*,officer:officers(name,phone,title)"
            },
            {
              "name": "tax_id",
              "value": "=eq.{{ $json.uniformno }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InllaW1laGRjZ3V3bnd6a21vcHN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzI5MTQsImV4cCI6MjA4MTA0ODkxNH0.OhQlheFmhJSoY-2U5OGPQQszSndZ0aHGBt-zsHOq0U4"
            },
            {
              "name": "Authorization",
              "value": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InllaW1laGRjZ3V3bnd6a21vcHN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzI5MTQsImV4cCI6MjA4MTA0ODkxNH0.OhQlheFmhJSoY-2U5OGPQQszSndZ0aHGBt-zsHOq0U4"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -624,
        2752
      ],
      "id": "3a123c0e-ce15-4dfb-9465-1b74ed3e366c",
      "name": "æŸ¥è©¢å®¢æˆ¶é€²åº¦è³‡æ–™"
    },
    {
      "parameters": {
        "operation": "send",
        "to": "={{ $('Webhook').item.json.body.events[0].source.userId }}",
        "messages": {
          "values": [
            {
              "quoteToken": "=",
              "text": "={{ $json.message }}"
            }
          ]
        }
      },
      "type": "@aotoki/n8n-nodes-line-messaging.lineMessaging",
      "typeVersion": 1,
      "position": [
        -128,
        2752
      ],
      "id": "6a597a22-01b2-4ea9-93fa-33ffb57e5575",
      "name": "å›å‚³æ¡ˆä»¶é€²åº¦",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1MeVmMZYOjrXAlTBlDIc7VoM30HuG1MufUgSPJpEEOvI",
          "mode": "list",
          "cachedResultName": "ç’°å¢ƒä¿è­·è¨±å¯ç®¡ç†ç³»çµ±",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MeVmMZYOjrXAlTBlDIc7VoM30HuG1MufUgSPJpEEOvI/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1638846679,
          "mode": "list",
          "cachedResultName": "åœŸåŸå€",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MeVmMZYOjrXAlTBlDIc7VoM30HuG1MufUgSPJpEEOvI/edit#gid=1638846679"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1488,
        16
      ],
      "id": "03643c32-b186-41c5-acb9-48a4216e5421",
      "name": "åŒæ­¥å€",
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "jsCode": "// å¾ Webhook å–å¾—è³‡æ–™\nconst input = $input.first().json.body.records;\nconst records =  $input.first().json.body.records|| [];\nconst sheetName = $input.first().json.body.sheetName || 'Unknown';\n\nconsole.log(`ğŸ“¥ æ”¶åˆ° ${records.length} ç­†è³‡æ–™ï¼Œä¾†è‡ªå·¥ä½œè¡¨ï¼š${sheetName}`);\n\nif (records.length === 0) {\n  throw new Error('æ²’æœ‰æ”¶åˆ°ä»»ä½•è³‡æ–™');\n}\n\n// è½‰æ›è³‡æ–™æ ¼å¼ï¼Œæº–å‚™ Upsert\nconst formatted = records.map(r => ({\n  ems_no: r.ems_no || '',\n  county: r.county || '',\n  company_name: r.company_name || '',\n  address: r.address || '',\n  process_id: '',\n  process_name: '',\n  category: r.category || 'æ“ä½œ',\n  permit_no: '',\n  effective_date: null,\n  expiry_date: r.expiry_date || ''  // å·²ç¶“æ˜¯ YYYY-MM-DD æ ¼å¼\n}));\n\nreturn formatted.map(item => ({ json: item }));"
      },
      "id": "fb85d21c-f861-4709-87dc-bc04b033a1da",
      "name": "æ ¼å¼è½‰æ›",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1328,
        -752
      ]
    },
    {
      "parameters": {
        "tableId": "air_permits",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "ems_no",
              "fieldValue": "={{ $json.ems_no }}"
            },
            {
              "fieldId": "county",
              "fieldValue": "={{ $json.county }}"
            },
            {
              "fieldId": "company_name",
              "fieldValue": "={{ $json.company_name }}"
            },
            {
              "fieldId": "address",
              "fieldValue": "={{ $json.address }}"
            },
            {
              "fieldId": "category",
              "fieldValue": "={{ $json.category }}"
            },
            {
              "fieldId": "expiry_date",
              "fieldValue": "={{ $json.expiry_date }}"
            }
          ]
        }
      },
      "id": "b2e20871-9449-43bd-a6cd-430dcdb94afc",
      "name": "Upsert Supabase",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -960,
        -688
      ],
      "credentials": "[REMOVED]"
    },
    {
      "parameters": {
        "jsCode": "// çµ±è¨ˆçµæœ\nconst items = $input.all();\nconst successCount = items.length;\n\nreturn [{\n  json: {\n    success: true,\n    message: `âœ… æˆåŠŸåŒæ­¥ ${successCount} ç­†è³‡æ–™`,\n    count: successCount,\n    timestamp: new Date().toISOString()\n  }\n}];"
      },
      "id": "91f90b91-e8a4-415d-9594-7a062c90a459",
      "name": "çµ±è¨ˆçµæœ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -768,
        -752
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "id": "e499b88b-2a92-458f-86bc-505a2e34242a",
      "name": "å›æ‡‰æˆåŠŸ",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        -544,
        -752
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\"success\": false, \"error\": \"{{ $json.error.message }}\"}",
        "options": {
          "responseCode": 500
        }
      },
      "id": "467b0774-049e-4325-bf7c-2c73d7610926",
      "name": "å›æ‡‰éŒ¯èª¤",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        -544,
        -560
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "sync-air-permits",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "f3c9f90b-5d06-47fc-b72e-ef10ed1ad241",
      "name": "Webhook1",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -1504,
        -752
      ],
      "webhookId": "[REMOVED]"
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "air_permits",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "ems_no",
              "condition": "eq",
              "keyValue": "={{ $json.ems_no }}"
            }
          ]
        }
      },
      "id": "348db92d-c029-4d02-8bad-25f019588604",
      "name": "Upsert Supabase1",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -960,
        -864
      ],
      "credentials": "[REMOVED]"
    }
  ],
  "pinData": {},
  "connections": {
    "11412 < X <11606": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "å–å¾—è©²çµ±ç·¨æ˜¯å¦å·²å­˜åœ¨",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Replace Me": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "ä¸€å€‹ä¸€å€‹æ–°å¢",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ä¸€å€‹ä¸€å€‹æ–°å¢": {
      "main": [
        [
          {
            "node": "Replace Me",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å–å¾—è©²çµ±ç·¨æ˜¯å¦å·²å­˜åœ¨": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [],
        [
          {
            "node": "Replace Me1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Replace Me1": {
      "main": [
        [
          {
            "node": "å–å¾—è©²çµ±ç·¨æ˜¯å¦å·²å­˜åœ¨1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "ä¸€å€‹ä¸€å€‹æ–°å¢1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ä¸€å€‹ä¸€å€‹æ–°å¢1": {
      "main": [
        [
          {
            "node": "Update row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å–å¾—è©²çµ±ç·¨æ˜¯å¦å·²å­˜åœ¨1": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ°´è¨±å¯": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update row in sheet": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Update row in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update row in sheet1": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ¯’è¨±å¯": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          },
          {
            "node": "ä¸€å€‹ä¸€å€‹æ–°å¢2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items2": {
      "main": [
        [],
        [
          {
            "node": "Replace Me2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Replace Me2": {
      "main": [
        [
          {
            "node": "å–å¾—è©²çµ±ç·¨æ˜¯å¦å·²å­˜åœ¨2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [],
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ä¸€å€‹ä¸€å€‹æ–°å¢2": {
      "main": [
        [
          {
            "node": "Update row in sheet2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å–å¾—è©²çµ±ç·¨æ˜¯å¦å·²å­˜åœ¨2": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update row in sheet2": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If4": {
      "main": [
        [
          {
            "node": "Update row in sheet3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update row in sheet3": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking â€˜Execute workflowâ€™": {
      "main": [
        [
          {
            "node": "æ¯’è¨±å¯",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          },
          {
            "node": "Line Messaging5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Line Messaging",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ä¸»å‹•æŸ¥è©¢æ˜¯å¦å¿«åˆ°æœŸ": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "1. åµæ¸¬çµ±ç·¨è¼¸å…¥",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "è¢«å‹•æŸ¥è©¢",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ç¢ºèªæ˜¯å¦å·²ç¶å®š",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Line Messaging3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ç”³å ±æŸ¥è©¢",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ç¢ºèªæ˜¯å¦å·²ç¶å®š1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Line Messaging6",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Line Messaging1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è¢«å‹•æŸ¥è©¢": {
      "main": [
        [
          {
            "node": "If5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ç”³å ±æŸ¥è©¢": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Line Messaging5": {
      "main": [
        []
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Line Messaging4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "1. è§£æç¶å®šè¼¸å…¥": {
      "main": [
        [
          {
            "node": "2. Firestore æ ¸å°è³‡æ–™",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "2. Firestore æ ¸å°è³‡æ–™": {
      "main": [
        [
          {
            "node": "3. æ­£å¼å»ºç«‹ç¶å®š",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "3. æ­£å¼å»ºç«‹ç¶å®š": {
      "main": [
        []
      ]
    },
    "ç¢ºèªæ˜¯å¦å·²ç¶å®š": {
      "main": [
        [
          {
            "node": "If6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If6": {
      "main": [
        [
          {
            "node": "2. Firestore ç¢ºèªå®¢æˆ¶èº«åˆ†1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "å›å‚³ç¶å®šå°å¼•",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ç¢ºèªæ˜¯å¦å·²ç¶å®š1": {
      "main": [
        [
          {
            "node": "If7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If7": {
      "main": [
        [
          {
            "node": "æŸ¥è©¢å®¢æˆ¶é€²åº¦è³‡æ–™",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "å›å‚³ç¶å®šå°å¼•1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "1. åµæ¸¬çµ±ç·¨è¼¸å…¥": {
      "main": [
        [
          {
            "node": "2. Firestore ç¢ºèªå®¢æˆ¶èº«åˆ†",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "2. Firestore ç¢ºèªå®¢æˆ¶èº«åˆ†": {
      "main": [
        [
          {
            "node": "Filter1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "3. å¿«é€Ÿå»ºç«‹ç¶å®š (Supabase)": {
      "main": [
        [
          {
            "node": "ç¶å®šæˆåŠŸ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If8": {
      "main": [
        [
          {
            "node": "Line Messaging2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ç¶å®šå¤±æ•—",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit": {
      "main": [
        [
          {
            "node": "3. å¿«é€Ÿå»ºç«‹ç¶å®š (Supabase)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "2. Firestore ç¢ºèªå®¢æˆ¶èº«åˆ†1": {
      "main": [
        [
          {
            "node": "Filter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          },
          {
            "node": "If9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "Line Messaging7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger1": {
      "main": [
        [
          {
            "node": "ä¸»å‹•æŸ¥è©¢æ˜¯å¦å¿«åˆ°æœŸ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items3": {
      "main": [
        [],
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Replace Me3": {
      "main": [
        []
      ]
    },
    "If5": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "å›å‚³ç¶å®šå°å¼•2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter1": {
      "main": [
        [
          {
            "node": "If8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Line Messaging": {
      "main": [
        [
          {
            "node": "Replace Me3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Line Messaging2": {
      "main": [
        [
          {
            "node": "Limit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æŸ¥è©¢å®¢æˆ¶é€²åº¦è³‡æ–™": {
      "main": [
        [
          {
            "node": "Code in JavaScript4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript4": {
      "main": [
        [
          {
            "node": "å›å‚³æ¡ˆä»¶é€²åº¦",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åŒæ­¥å€": {
      "main": [
        [
          {
            "node": "11412 < X <11606",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ ¼å¼è½‰æ›": {
      "main": [
        [
          {
            "node": "Upsert Supabase1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Upsert Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upsert Supabase": {
      "main": [
        [
          {
            "node": "çµ±è¨ˆçµæœ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "çµ±è¨ˆçµæœ": {
      "main": [
        [
          {
            "node": "å›æ‡‰æˆåŠŸ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook1": {
      "main": [
        [
          {
            "node": "æ ¼å¼è½‰æ›",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upsert Supabase1": {
      "main": [
        []
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "3d6064fa-af5b-44b2-9af2-9a8b98ecb6ba",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "5cb73612af9c3d99fb9474cf656425558c43c24de4951be223ad83a0b24b4e43"
  },
  "id": "k9QVDfOkeNRUoTIo",
  "tags": []
}